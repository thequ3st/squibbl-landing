<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Squibbl Services</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 30px;
  }

  .service {
    background: #fff;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .service-name {
    font-weight: bold;
    flex: 1;
  }

  .status-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    vertical-align: middle;
    background-color: grey;
  }

  .uptime {
    margin-left: 8px;
    font-size: 0.85em;
    color: #333;
  }

  canvas {
    width: 300px;
    height: 50px;
  }
</style>
</head>
<body>

<h1>Squibbl Services</h1>

<div id="services-container">
  <!-- Service blocks inserted via JS -->
</div>

<script>
const services = [
  { id: 'jellyfin', name: 'Jellyfin', history: [] },
  { id: 'headphones', name: 'Headphones', history: [] },
  { id: 'jellyseerr', name: 'Jellyseerr', history: [] },
  { id: 'plex', name: 'Plex', history: [] },
  { id: 'wizarr', name: 'Wizarr', history: [] }
];

// Create service blocks
const container = document.getElementById('services-container');
services.forEach(service => {
  const div = document.createElement('div');
  div.className = 'service';
  div.innerHTML = `
    <span class="status-indicator" id="${service.id}-status"></span>
    <span class="service-name">${service.name}</span>
    <canvas id="${service.id}-graph" width="300" height="50"></canvas>
    <span class="uptime" id="${service.id}-uptime"></span>
  `;
  container.appendChild(div);
});

// Function to simulate checking service (replace with real fetch/ping if you like)
function checkService(service) {
  // Random online/offline simulation for demo
  const isOnline = Math.random() > 0.1 ? 1 : 0;
  service.history.push(isOnline);
  if(service.history.length > 24) service.history.shift(); // keep last 24 points
  return isOnline;
}

// Update UI for a service
function updateServiceUI(service) {
  // Status indicator
  const statusEl = document.getElementById(`${service.id}-status`);
  const lastStatus = service.history[service.history.length-1];
  statusEl.style.backgroundColor = lastStatus ? '#28a745' : '#dc3545';

  // Uptime %
  const uptimePercent = ((service.history.filter(v => v).length / service.history.length) * 100).toFixed(0);
  document.getElementById(`${service.id}-uptime`).innerText = `${uptimePercent}% uptime`;

  // Draw graph
  drawGraph(service);
}

// Draw graph
function drawGraph(service) {
  const canvas = document.getElementById(`${service.id}-graph`);
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(service.history.length < 2) return;

  const stepX = canvas.width / (service.history.length - 1);

  // Smooth curve
  ctx.beginPath();
  for(let i = 0; i < service.history.length; i++) {
    const x = i * stepX;
    const y = canvas.height - service.history[i] * canvas.height;
    if(i===0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  }

  // Green line
  ctx.strokeStyle = '#28a745';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Red dots for offline points
  for(let i=0;i<service.history.length;i++){
    if(service.history[i]===0){
      const x=i*stepX;
      const y=canvas.height/2;
      ctx.beginPath();
      ctx.arc(x,y,3,0,Math.PI*2);
      ctx.fillStyle='#dc3545';
      ctx.fill();
    }
  }
}

// Main loop to update all services
function updateAllServices() {
  services.forEach(service => {
    checkService(service);
    updateServiceUI(service);
  });
}

// Initial update
updateAllServices();

// Update every 10 seconds
setInterval(updateAllServices, 10000);
</script>

</body>
</html>
